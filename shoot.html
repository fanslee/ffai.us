<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>扫射贾跃亭</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }
        .container {
            max-width: 900px;
            width: 100%;
            text-align: center;
        }
        header {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            color: #ffcc00;
        }
        .subtitle {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #ffcc00;
        }
        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        .stats {
            display: flex;
            justify-content: space-between;
            width: 100%;
            background: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 10px;
            font-size: 1.2rem;
        }
        .stat-box {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #ffcc00;
        }
        #gameCanvas {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            cursor: crosshair;
        }
        .controls {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }
        button {
            padding: 12px 25px;
            font-size: 1.1rem;
            background: linear-gradient(to bottom, #ff9900, #ff6600);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 0 #cc5200;
        }
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 0 #cc5200;
        }
        button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 0 #cc5200;
        }
        .instructions {
            margin-top: 20px;
            background: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 10px;
            text-align: left;
            max-width: 600px;
        }
        .instructions h3 {
            color: #ffcc00;
            margin-bottom: 10px;
            text-align: center;
        }
        .instructions ul {
            list-style-type: none;
            padding-left: 10px;
        }
        .instructions li {
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }
        .instructions li:before {
            content: "•";
            color: #ffcc00;
            position: absolute;
            left: 0;
        }
        .difficulty {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .difficulty-btn {
            padding: 8px 15px;
            font-size: 0.9rem;
            background: linear-gradient(to bottom, #6666ff, #3333cc);
        }
        .difficulty-btn.active {
            background: linear-gradient(to bottom, #ff9900, #ff6600);
        }
        
        /* 全屏模式下的控制面板 */
        #fullscreenControls {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            display: none;
            z-index: 1000;
            gap: 10px;
        }
        
        #fullscreenControls button {
            padding: 8px 16px;
            font-size: 0.9rem;
        }
        
        footer {
            margin-top: 20px;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
        }
        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }
            .stats {
                flex-direction: column;
                gap: 10px;
            }
            #gameCanvas {
                width: 100%;
                height: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>扫射贾跃亭</h1>
            <p class="subtitle">发泄你的情绪，扫射一切不快！</p>
        </header>
        
        <div class="game-area">
            <div class="stats">
                <div class="stat-box">
                    <div>得分</div>
                    <div class="stat-value" id="score">0</div>
                </div>
                <div class="stat-box">
                    <div>弹药</div>
                    <div class="stat-value" id="ammo">1000</div>
                </div>
                <div class="stat-box">
                    <div>连击</div>
                    <div class="stat-value" id="combo">0</div>
                </div>
                <div class="stat-box">
                    <div>时间</div>
                    <div class="stat-value" id="timer">120</div>
                </div>
            </div>
            
            <canvas id="gameCanvas" width="800" height="500"></canvas>
            
            <div class="controls">
                <button id="startBtn">开始游戏</button>
                <button id="restartBtn">重新开始</button>
                <button id="fullscreenBtn">全屏模式</button>
            </div>
            
            <div class="difficulty">
                <button class="difficulty-btn active" data-time="180" data-ammo="1500">简单 (3分钟)</button>
                <button class="difficulty-btn" data-time="120" data-ammo="1000">普通 (2分钟)</button>
                <button class="difficulty-btn" data-time="90" data-ammo="700">困难 (1.5分钟)</button>
            </div>
            
            <div class="instructions">
                <h3>游戏说明</h3>
                <ul>
                    <li>移动鼠标瞄准，点击鼠标左键发射加特林子弹</li>
                    <li>击中贾跃亭形象获得10分，连续击中增加连击倍数</li>
                    <li>击中特殊部位（头部）获得双倍分数</li>
                    <li>选择不同难度，游戏时间和弹药量会变化</li>
                    <li>弹药有限，请合理使用！</li>
                    <li>按ESC键可退出全屏模式</li>
                </ul>
            </div>
        </div>
        
        <footer>
            <p>本游戏仅供娱乐，人物形象经过艺术化处理</p>
        </footer>
    </div>

    <!-- 全屏模式下的控制面板 -->
    <div id="fullscreenControls">
        <button id="fsStartBtn">开始游戏</button>
        <button id="fsRestartBtn">重新开始</button>
        <button id="exitFullscreenBtn">退出全屏</button>
    </div>

    <script>
        // 游戏核心代码
        document.addEventListener('DOMContentLoaded', function() {
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const scoreElement = document.getElementById('score');
            const ammoElement = document.getElementById('ammo');
            const comboElement = document.getElementById('combo');
            const timerElement = document.getElementById('timer');
            const startBtn = document.getElementById('startBtn');
            const restartBtn = document.getElementById('restartBtn');
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            const difficultyBtns = document.querySelectorAll('.difficulty-btn');
            
            // 全屏控制元素
            const fullscreenControls = document.getElementById('fullscreenControls');
            const fsStartBtn = document.getElementById('fsStartBtn');
            const fsRestartBtn = document.getElementById('fsRestartBtn');
            const exitFullscreenBtn = document.getElementById('exitFullscreenBtn');
            
            // 游戏变量
            let score = 0;
            let ammo = 1000;
            let combo = 0;
            let timeLeft = 120;
            let gameActive = false;
            let gameLoop;
            let timerInterval;
            let targets = [];
            let particles = [];
            let lastShotTime = 0;
            let shootRate = 80; // 毫秒
            let mouseX = canvas.width / 2;
            let mouseY = canvas.height / 2;
            let isMouseDown = false;
            let isFullscreen = false;
            
            // 难度设置
            let gameDuration = 120; // 默认2分钟
            let maxAmmo = 1000;
            
            // 设置难度
            difficultyBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    difficultyBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    gameDuration = parseInt(this.dataset.time);
                    maxAmmo = parseInt(this.dataset.ammo);
                    
                    if (!gameActive) {
                        timeLeft = gameDuration;
                        ammo = maxAmmo;
                        updateUI();
                    }
                });
            });
            
            // 创建音效
            function createShotSound() {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(120, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(40, audioContext.currentTime + 0.1);
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);
                } catch (e) {
                    console.log('音效创建失败:', e);
                }
            }
            
            function createHitSound() {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 0.2);
                    
                    gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.2);
                } catch (e) {
                    console.log('音效创建失败:', e);
                }
            }
            
            // 目标类
            class Target {
                constructor() {
                    this.width = 120;
                    this.height = 180;
                    this.x = Math.random() * (canvas.width - this.width);
                    this.y = Math.random() * (canvas.height - this.height - 100) + 50;
                    this.speedX = (Math.random() - 0.5) * 3;
                    this.speedY = (Math.random() - 0.5) * 2;
                    this.health = 100;
                    this.hit = false;
                    this.hitTimer = 0;
                }
                
                update() {
                    this.x += this.speedX;
                    this.y += this.speedY;
                    
                    // 边界检测
                    if (this.x <= 0 || this.x + this.width >= canvas.width) {
                        this.speedX *= -1;
                    }
                    if (this.y <= 50 || this.y + this.height >= canvas.height) {
                        this.speedY *= -1;
                    }
                    
                    // 击中效果计时
                    if (this.hit) {
                        this.hitTimer++;
                        if (this.hitTimer > 10) {
                            this.hit = false;
                            this.hitTimer = 0;
                        }
                    }
                }
                
                draw() {
                    // 绘制身体
                    ctx.fillStyle = this.hit ? '#ff3333' : '#3366cc';
                    ctx.fillRect(this.x, this.y, this.width, this.height);
                    
                    // 绘制头部
                    ctx.fillStyle = this.hit ? '#ff6666' : '#6699ff';
                    ctx.beginPath();
                    ctx.arc(this.x + this.width/2, this.y - 20, 40, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // 绘制面部特征
                    ctx.fillStyle = '#000000';
                    ctx.beginPath();
                    ctx.arc(this.x + this.width/2 - 15, this.y - 25, 8, 0, Math.PI * 2); // 左眼
                    ctx.arc(this.x + this.width/2 + 15, this.y - 25, 8, 0, Math.PI * 2); // 右眼
                    ctx.fill();
                    
                    ctx.beginPath();
                    ctx.arc(this.x + this.width/2, this.y, 15, 0, Math.PI); // 嘴
                    ctx.stroke();
                    
                    // 绘制文字标识
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '16px Arial';
                    ctx.fillText('贾跃亭', this.x + this.width/2 - 25, this.y + this.height/2);
                }
                
                isHit(x, y) {
                    // 检查是否击中头部（双倍分数）
                    const headCenterX = this.x + this.width/2;
                    const headCenterY = this.y - 20;
                    const headRadius = 40;
                    
                    // 检查是否击中身体
                    const bodyHit = x > this.x && x < this.x + this.width && 
                                    y > this.y && y < this.y + this.height;
                    
                    // 检查是否击中头部
                    const headHit = Math.sqrt((x - headCenterX) ** 2 + (y - headCenterY) ** 2) < headRadius;
                    
                    return {
                        hit: bodyHit || headHit,
                        isHead: headHit
                    };
                }
            }
            
            // 粒子类（用于射击效果）
            class Particle {
                constructor(x, y, color) {
                    this.x = x;
                    this.y = y;
                    this.size = Math.random() * 5 + 2;
                    this.speedX = Math.random() * 6 - 3;
                    this.speedY = Math.random() * 6 - 3;
                    this.color = color;
                    this.life = 30;
                }
                
                update() {
                    this.x += this.speedX;
                    this.y += this.speedY;
                    this.life--;
                }
                
                draw() {
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            
            // 初始化游戏
            function initGame() {
                score = 0;
                ammo = maxAmmo;
                combo = 0;
                timeLeft = gameDuration;
                targets = [];
                particles = [];
                
                // 创建初始目标
                for (let i = 0; i < 5; i++) {
                    targets.push(new Target());
                }
                
                updateUI();
            }
            
            // 更新UI
            function updateUI() {
                scoreElement.textContent = score;
                ammoElement.textContent = ammo;
                comboElement.textContent = combo;
                timerElement.textContent = timeLeft;
            }
            
            // 绘制游戏场景
            function draw() {
                // 清除画布
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // 绘制背景
                const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
                gradient.addColorStop(0, '#1a1a2e');
                gradient.addColorStop(1, '#16213e');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // 绘制目标
                targets.forEach(target => {
                    target.draw();
                });
                
                // 绘制粒子
                particles.forEach((particle, index) => {
                    particle.draw();
                    if (particle.life <= 0) {
                        particles.splice(index, 1);
                    }
                });
                
                // 绘制准星
                ctx.strokeStyle = '#ff0000';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(mouseX - 15, mouseY);
                ctx.lineTo(mouseX + 15, mouseY);
                ctx.moveTo(mouseX, mouseY - 15);
                ctx.lineTo(mouseX, mouseY + 15);
                ctx.stroke();
                
                // 绘制加特林机枪
                ctx.fillStyle = '#444444';
                ctx.fillRect(mouseX - 10, canvas.height - 30, 20, 30);
                ctx.fillRect(mouseX - 30, canvas.height - 20, 60, 10);
                
                // 绘制弹药轨迹（如果正在射击）
                if (isMouseDown && ammo > 0 && gameActive) {
                    ctx.strokeStyle = '#ffff00';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(mouseX, canvas.height - 30);
                    ctx.lineTo(mouseX, mouseY);
                    ctx.stroke();
                }
                
                // 绘制游戏状态
                if (!gameActive) {
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    ctx.fillStyle = '#ffffff';
                    ctx.font = '40px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('加特林狂扫贾跃亭', canvas.width/2, canvas.height/2 - 50);
                    
                    ctx.font = '24px Arial';
                    if (isFullscreen) {
                        ctx.fillText('点击"开始游戏"按钮开始', canvas.width/2, canvas.height/2 + 20);
                    } else {
                        ctx.fillText('点击"开始游戏"按钮开始', canvas.width/2, canvas.height/2 + 20);
                    }
                }
            }
            
            // 游戏主循环
            function update() {
                if (!gameActive) return;
                
                // 更新目标
                targets.forEach(target => {
                    target.update();
                });
                
                // 更新粒子
                particles.forEach(particle => {
                    particle.update();
                });
                
                // 处理射击
                if (isMouseDown && ammo > 0) {
                    const currentTime = Date.now();
                    if (currentTime - lastShotTime > shootRate) {
                        shoot();
                        lastShotTime = currentTime;
                    }
                }
                
                // 随机添加新目标
                if (Math.random() < 0.02 && targets.length < 10) {
                    targets.push(new Target());
                }
                
                // 绘制游戏
                draw();
            }
            
            // 射击函数
            function shoot() {
                if (ammo <= 0) return;
                
                ammo--;
                createShotSound();
                
                // 创建枪口火焰粒子
                for (let i = 0; i < 5; i++) {
                    particles.push(new Particle(
                        mouseX + (Math.random() - 0.5) * 10,
                        canvas.height - 30,
                        '#ff9900'
                    ));
                }
                
                // 检查是否击中目标
                let hitSomething = false;
                targets.forEach((target, index) => {
                    const hitResult = target.isHit(mouseX, mouseY);
                    if (hitResult.hit) {
                        hitSomething = true;
                        createHitSound();
                        
                        // 创建击中粒子
                        for (let i = 0; i < 10; i++) {
                            particles.push(new Particle(
                                mouseX + (Math.random() - 0.5) * 30,
                                mouseY + (Math.random() - 0.5) * 30,
                                '#ff0000'
                            ));
                        }
                        
                        // 计算得分
                        let points = 10;
                        if (hitResult.isHead) {
                            points *= 2;
                            combo += 2;
                        } else {
                            combo += 1;
                        }
                        
                        score += points * (1 + combo / 10);
                        score = Math.round(score);
                        
                        target.hit = true;
                        target.health -= 34;
                        
                        // 如果目标生命值耗尽，移除它
                        if (target.health <= 0) {
                            targets.splice(index, 1);
                            // 添加一个新目标
                            targets.push(new Target());
                        }
                    }
                });
                
                // 如果没有击中任何目标，重置连击
                if (!hitSomething) {
                    combo = 0;
                }
                
                updateUI();
            }
            
            // 开始游戏
            function startGame() {
                if (gameActive) return;
                
                gameActive = true;
                startBtn.textContent = "游戏进行中";
                startBtn.disabled = true;
                fsStartBtn.textContent = "游戏进行中";
                fsStartBtn.disabled = true;
                
                // 启动游戏循环
                gameLoop = setInterval(update, 1000 / 60); // 60 FPS
                
                // 启动计时器（每秒更新一次）
                timerInterval = setInterval(() => {
                    timeLeft--;
                    updateUI();
                    
                    if (timeLeft <= 0) {
                        endGame();
                    }
                }, 1000);
            }
            
            // 结束游戏
            function endGame() {
                gameActive = false;
                clearInterval(gameLoop);
                clearInterval(timerInterval);
                
                startBtn.textContent = "开始游戏";
                startBtn.disabled = false;
                fsStartBtn.textContent = "开始游戏";
                fsStartBtn.disabled = false;
                
                // 显示结束画面
                ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = '#ffffff';
                ctx.font = '40px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('游戏结束!', canvas.width/2, canvas.height/2 - 50);
                
                ctx.font = '30px Arial';
                ctx.fillText(`最终得分: ${score}`, canvas.width/2, canvas.height/2);
                
                ctx.font = '20px Arial';
                ctx.fillText('点击"重新开始"按钮再玩一次', canvas.width/2, canvas.height/2 + 50);
            }
            
            // 进入全屏模式
            function enterFullscreen() {
                if (canvas.requestFullscreen) {
                    canvas.requestFullscreen();
                } else if (canvas.webkitRequestFullscreen) {
                    canvas.webkitRequestFullscreen();
                } else if (canvas.mozRequestFullScreen) {
                    canvas.mozRequestFullScreen();
                } else if (canvas.msRequestFullscreen) {
                    canvas.msRequestFullscreen();
                }
            }
            
            // 退出全屏模式
            function exitFullscreen() {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.mozCancelFullScreen) {
                    document.mozCancelFullScreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
            }
            
            // 全屏状态变化监听
            document.addEventListener('fullscreenchange', handleFullscreenChange);
            document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
            document.addEventListener('mozfullscreenchange', handleFullscreenChange);
            document.addEventListener('MSFullscreenChange', handleFullscreenChange);
            
            function handleFullscreenChange() {
                isFullscreen = !!(document.fullscreenElement || 
                                document.webkitFullscreenElement || 
                                document.mozFullScreenElement ||
                                document.msFullscreenElement);
                
                if (isFullscreen) {
                    fullscreenControls.style.display = 'flex';
                    // 调整canvas尺寸适应全屏
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                    // 重新初始化游戏
                    if (gameActive) {
                        endGame();
                    }
                    initGame();
                    draw();
                } else {
                    fullscreenControls.style.display = 'none';
                    // 恢复canvas原始尺寸
                    canvas.width = 800;
                    canvas.height = 500;
                    // 重新初始化游戏
                    if (gameActive) {
                        endGame();
                    }
                    initGame();
                    draw();
                }
            }
            
            // 事件监听
            canvas.addEventListener('mousemove', function(e) {
                const rect = canvas.getBoundingClientRect();
                mouseX = e.clientX - rect.left;
                mouseY = e.clientY - rect.top;
            });
            
            canvas.addEventListener('mousedown', function() {
                isMouseDown = true;
            });
            
            canvas.addEventListener('mouseup', function() {
                isMouseDown = false;
            });
            
            // 普通模式按钮事件
            startBtn.addEventListener('click', startGame);
            restartBtn.addEventListener('click', function() {
                initGame();
                if (gameActive) {
                    endGame();
                }
                draw();
            });
            
            // 全屏模式按钮事件
            fsStartBtn.addEventListener('click', startGame);
            fsRestartBtn.addEventListener('click', function() {
                initGame();
                if (gameActive) {
                    endGame();
                }
                draw();
            });
            exitFullscreenBtn.addEventListener('click', exitFullscreen);
            
            fullscreenBtn.addEventListener('click', enterFullscreen);
            
            // ESC键退出全屏
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && isFullscreen) {
                    exitFullscreen();
                }
            });
            
            // 触摸设备支持
            canvas.addEventListener('touchstart', function(e) {
                e.preventDefault();
                isMouseDown = true;
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                mouseX = touch.clientX - rect.left;
                mouseY = touch.clientY - rect.top;
            });
            
            canvas.addEventListener('touchmove', function(e) {
                e.preventDefault();
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                mouseX = touch.clientX - rect.left;
                mouseY = touch.clientY - rect.top;
            });
            
            canvas.addEventListener('touchend', function() {
                isMouseDown = false;
            });
            
            // 初始化并绘制初始画面
            initGame();
            draw();
        });
    </script>
</body>
</html>
